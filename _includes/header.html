<header class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="{{ "/" | relative_url }}">{{ site.title | escape }}</a>

    <nav class="site-nav">
      <a class="menu-icon" href="#">
        <svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/></svg>
      </a>

      <div class="trigger">
        {%- for path in site.header_pages -%}
          {%- assign my_page = site.pages | where: "path", path | first -%}
          {%- if my_page.title -%}
          <a class="page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </nav>

    <div id="search-container">
      <input type="text" id="search-input" placeholder="Loading..." disabled>
      <ul id="search-results"></ul>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var menuIcon = document.querySelector('.menu-icon');
    var menu = document.querySelector('.trigger');
    menuIcon.addEventListener('click', function(e) {
      e.preventDefault();
      menu.classList.toggle('active');
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/gh/nextapps-de/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('search-input');
    const resultsContainer = document.getElementById('search-results');
    let index;
    let documents;

    // Fetch and initialize the search index
    fetch('{{ "/search.json" | absolute_url }}')
      .then(response => response.json())
      .then(docs => {
        documents = docs;
        index = new FlexSearch.Document({
          document: { id: "url", index: ["title", "content"] },
          tokenize: "forward"
        });
        index.add(documents);
        searchInput.placeholder = "Search...";
        searchInput.disabled = false;
      });

    // Show/hide results on focus/blur
    searchInput.addEventListener('focus', () => {
      if (searchInput.value) resultsContainer.style.display = 'block';
    });
    document.addEventListener('click', (event) => {
      if (!document.getElementById('search-container').contains(event.target)) {
        resultsContainer.style.display = 'none';
      }
    });

    // Handle search input
    searchInput.addEventListener('input', function () {
      const query = this.value;
      if (!query) {
        resultsContainer.innerHTML = '';
        resultsContainer.style.display = 'none';
        return;
      }

      const searchResults = index.search(query, { enrich: true, limit: 5 });
      resultsContainer.innerHTML = '';

      if (searchResults.length === 0 || searchResults[0].result.length === 0) {
        resultsContainer.innerHTML = '<li>No results found</li>';
      } else {
        searchResults[0].result.forEach(result => {
          const doc = result.doc;
          const li = document.createElement('li');
          li.innerHTML = `<a href="${doc.url}">${doc.title}</a>`;
          resultsContainer.appendChild(li);
        });
      }
      resultsContainer.style.display = 'block';
    });
  });
</script>
